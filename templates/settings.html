<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIBA - Settings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='settings.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="settings-container">
        <!-- Header -->
        <div class="settings-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="settings-title">‚öôÔ∏è Settings</h1>
                    <p class="settings-subtitle">Manage your business profile and preferences</p>
                </div>
                <div class="header-actions">
                    <a href="/" class="btn btn-secondary">
                        ‚Üê Back to Chat
                    </a>
                    <button class="btn btn-outline" onclick="logout()">
                        üö™ Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="settings-content">
            <!-- Navigation Tabs -->
            <div class="settings-nav">
                <button class="nav-tab active" onclick="showTab('business')" id="businessTab">
                    üè¢ Business Information
                </button>
                <button class="nav-tab" onclick="showTab('bank')" id="bankTab">
                    üè¶ Bank Details
                </button>
                <button class="nav-tab" onclick="showTab('account')" id="accountTab">
                    üë§ Account Settings
                </button>
            </div>

            <!-- Business Information Tab -->
            <div class="tab-content active" id="businessContent">
                <div class="settings-card">
                    <div class="card-header">
                        <h2>Business Information</h2>
                        <p>This information appears on all your PDF documents</p>
                    </div>

                    <form id="businessForm" onsubmit="updateBusinessInfo(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="businessName" class="required">Business Name</label>
                                <input 
                                    type="text" 
                                    id="businessName" 
                                    class="form-input" 
                                    placeholder="Enter business name"
                                    value="{{ profile.business_info.business_name if profile else '' }}"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="gstin">GSTIN</label>
                                <input 
                                    type="text" 
                                    id="gstin" 
                                    class="form-input" 
                                    placeholder="22AAAAA0000A1Z5"
                                    value="{{ profile.business_info.gstin if profile else '' }}"
                                >
                            </div>

                            <div class="form-group full-width">
                                <label for="address" class="required">Registered Address</label>
                                <textarea 
                                    id="address" 
                                    class="form-input" 
                                    rows="3"
                                    placeholder="Enter complete business address"
                                    required
                                >{{ profile.business_info.address if profile else '' }}</textarea>
                            </div>

                            <div class="form-group">
                                <label for="state">State</label>
                                <input 
                                    type="text" 
                                    id="state" 
                                    class="form-input" 
                                    placeholder="e.g., Maharashtra"
                                    value="{{ profile.business_info.state if profile else '' }}"
                                >
                            </div>

                            <div class="form-group">
                                <label for="pincode">Pincode</label>
                                <input 
                                    type="text" 
                                    id="pincode" 
                                    class="form-input" 
                                    placeholder="400001"
                                    value="{{ profile.business_info.pincode if profile else '' }}"
                                >
                            </div>

                            <div class="form-group">
                                <label for="email" class="required">Business Email</label>
                                <input 
                                    type="email" 
                                    id="email" 
                                    class="form-input" 
                                    placeholder="business@example.com"
                                    value="{{ profile.business_info.email if profile else '' }}"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="phone" class="required">Phone Number</label>
                                <input 
                                    type="tel" 
                                    id="phone" 
                                    class="form-input" 
                                    placeholder="+91 98765 43210"
                                    value="{{ profile.business_info.phone if profile else '' }}"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="website">Website</label>
                                <input 
                                    type="url" 
                                    id="website" 
                                    class="form-input" 
                                    placeholder="www.yourbusiness.com"
                                    value="{{ profile.business_info.website if profile else '' }}"
                                >
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="businessSaveBtn">
                                <span class="btn-text">üíæ Save Changes</span>
                                <span class="btn-loader" style="display: none;">
                                    <div class="spinner"></div>
                                    Saving...
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bank Details Tab -->
            <div class="tab-content" id="bankContent">
                <div class="settings-card">
                    <div class="card-header">
                        <h2>Bank Details</h2>
                        <p>Banking information for payment details in documents</p>
                    </div>

                    <form id="bankForm" onsubmit="updateBankInfo(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="accountName" class="required">Account Holder Name</label>
                                <input 
                                    type="text" 
                                    id="accountName" 
                                    class="form-input" 
                                    placeholder="Account holder name"
                                    value="{{ profile.bank_info.account_name if profile else '' }}"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="accountNumber" class="required">Account Number</label>
                                <input 
                                    type="text" 
                                    id="accountNumber" 
                                    class="form-input" 
                                    placeholder="123456789012"
                                    value="{{ profile.bank_info.account_number if profile else '' }}"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="bankName" class="required">Bank Name</label>
                                <input 
                                    type="text" 
                                    id="bankName" 
                                    class="form-input" 
                                    placeholder="State Bank of India"
                                    value="{{ profile.bank_info.bank_name if profile else '' }}"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="ifscCode" class="required">IFSC Code</label>
                                <input 
                                    type="text" 
                                    id="ifscCode" 
                                    class="form-input" 
                                    placeholder="SBIN0001234"
                                    value="{{ profile.bank_info.ifsc_code if profile else '' }}"
                                    required
                                >
                            </div>

                            <div class="form-group full-width">
                                <label for="branch">Branch Name</label>
                                <input 
                                    type="text" 
                                    id="branch" 
                                    class="form-input" 
                                    placeholder="Mumbai Main Branch"
                                    value="{{ profile.bank_info.branch if profile else '' }}"
                                >
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="bankSaveBtn">
                                <span class="btn-text">üíæ Save Changes</span>
                                <span class="btn-loader" style="display: none;">
                                    <div class="spinner"></div>
                                    Saving...
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Account Settings Tab -->
            <div class="tab-content" id="accountContent">
                <div class="settings-card">
                    <div class="card-header">
                        <h2>Account Settings</h2>
                        <p>Manage your account preferences and security</p>
                    </div>

                    <div class="account-section">
                        <h3>üìä Usage Statistics</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">-</div>
                                <div class="stat-label">PDFs Generated</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">-</div>
                                <div class="stat-label">Documents Created</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">-</div>
                                <div class="stat-label">Active Since</div>
                            </div>
                        </div>
                    </div>

                    <div class="account-section">
                        <h3>üîê Security</h3>
                        <div class="security-actions">
                            <button class="btn btn-outline" onclick="changePassword()">
                                üîë Change Password
                            </button>
                            <button class="btn btn-outline" onclick="downloadData()">
                                üìÅ Download My Data
                            </button>
                        </div>
                    </div>

                    <div class="account-section danger-zone">
                        <h3>‚ö†Ô∏è Danger Zone</h3>
                        <p>These actions cannot be undone</p>
                        <div class="danger-actions">
                            <button class="btn btn-danger" onclick="clearAllData()">
                                üóëÔ∏è Clear All Data
                            </button>
                            <button class="btn btn-danger" onclick="deleteAccount()">
                                ‚ùå Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div class="message-container" id="messageContainer" style="display: none;">
            <div class="message" id="messageContent"></div>
        </div>
    </div>

    <script>
        // Tab switching
        function showTab(tab) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tab + 'Content').classList.add('active');
        }

        // Update business information
        async function updateBusinessInfo(event) {
            event.preventDefault();

            const btn = document.getElementById('businessSaveBtn');
            setLoading(btn, true);

            const businessData = {
                business_info: {
                    business_name: document.getElementById('businessName').value.trim(),
                    gstin: document.getElementById('gstin').value.trim(),
                    address: document.getElementById('address').value.trim(),
                    state: document.getElementById('state').value.trim(),
                    pincode: document.getElementById('pincode').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    website: document.getElementById('website').value.trim(),
                }
            };

            try {
                const response = await fetch('/auth/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(businessData)
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Business information updated successfully!', 'success');
                } else {
                    showMessage(data.message, 'error');
                }

            } catch (error) {
                showMessage('Failed to update business information', 'error');
            } finally {
                setLoading(btn, false);
            }
        }

        // Update bank information
        async function updateBankInfo(event) {
            event.preventDefault();

            const btn = document.getElementById('bankSaveBtn');
            setLoading(btn, true);

            const bankData = {
                bank_info: {
                    account_name: document.getElementById('accountName').value.trim(),
                    account_number: document.getElementById('accountNumber').value.trim(),
                    bank_name: document.getElementById('bankName').value.trim(),
                    ifsc_code: document.getElementById('ifscCode').value.trim().toUpperCase(),
                    branch: document.getElementById('branch').value.trim(),
                }
            };

            try {
                const response = await fetch('/auth/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bankData)
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Bank details updated successfully!', 'success');
                } else {
                    showMessage(data.message, 'error');
                }

            } catch (error) {
                showMessage('Failed to update bank details', 'error');
            } finally {
                setLoading(btn, false);
            }
        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/auth/logout', { method: 'POST' });
                if (response.ok) {
                    window.location.href = '/auth';
                }
            } catch (error) {
                console.error('Logout failed:', error);
            }
        }

        // Placeholder functions for account actions
        function changePassword() {
            showMessage('Password change functionality coming soon!', 'info');
        }

        function downloadData() {
            showMessage('Data export functionality coming soon!', 'info');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                showMessage('Data clearing functionality coming soon!', 'info');
            }
        }

        function deleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                showMessage('Account deletion functionality coming soon!', 'info');
            }
        }

        // Utility functions
        function setLoading(btn, loading) {
            const text = btn.querySelector('.btn-text');
            const loader = btn.querySelector('.btn-loader');

            if (loading) {
                text.style.display = 'none';
                loader.style.display = 'flex';
                btn.disabled = true;
            } else {
                text.style.display = 'block';
                loader.style.display = 'none';
                btn.disabled = false;
            }
        }

        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const content = document.getElementById('messageContent');

            content.textContent = message;
            container.className = `message-container ${type}`;
            container.style.display = 'block';

            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }

        // Auto-format inputs
        document.getElementById('gstin').addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });

        document.getElementById('ifscCode').addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });

        document.getElementById('pincode').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').substring(0, 6);
        });
    </script>
</body>
</html> 