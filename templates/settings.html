<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIBA - Settings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='settings.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="grok-settings-body">
    <!-- Background Elements -->
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>
    <div class="floating-elements">
        <div class="floating-element" style="--x: 10%; --y: 20%; --delay: 0s;"></div>
        <div class="floating-element" style="--x: 80%; --y: 30%; --delay: 2s;"></div>
        <div class="floating-element" style="--x: 60%; --y: 70%; --delay: 4s;"></div>
        <div class="floating-element" style="--x: 20%; --y: 80%; --delay: 1s;"></div>
        <div class="floating-element" style="--x: 90%; --y: 60%; --delay: 3s;"></div>
    </div>

    <div class="grok-settings-container">
        <!-- Header Section -->
        <div class="grok-settings-header">
            <div class="settings-brand">
                <div class="brand-icon">‚öôÔ∏è</div>
                <div class="brand-text">
                    <h1>AIBA Settings</h1>
                    <p>Configure your AI Business Assistant</p>
                </div>
            </div>
            
            <div class="header-actions">
                <a href="/" class="grok-secondary-btn">
                    <span class="btn-icon">‚Üê</span>
                    Back to Chat
                </a>
                <button class="grok-outline-btn" onclick="logout()">
                    <span class="btn-icon">üö™</span>
                    Logout
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="grok-tabs-container">
            <div class="grok-tabs">
                <button class="grok-tab active" onclick="showTab('business')" id="businessTab">
                    <span class="tab-icon">üè¢</span>
                    <span class="tab-text">Business Info</span>
                </button>
                <button class="grok-tab" onclick="showTab('bank')" id="bankTab">
                    <span class="tab-icon">üè¶</span>
                    <span class="tab-text">Bank Details</span>
                </button>
                <button class="grok-tab" onclick="showTab('account')" id="accountTab">
                    <span class="tab-icon">üë§</span>
                    <span class="tab-text">Account</span>
                </button>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="grok-content-container">
            <!-- Business Information Tab -->
            <div class="grok-tab-content active" id="businessContent">
                <div class="grok-settings-card">
                    <div class="grok-card-header">
                        <h2>Business Information</h2>
                        <p>This information appears on all your PDF documents</p>
                    </div>

                    <form class="grok-form" id="businessForm" onsubmit="updateBusinessInfo(event)">
                        <div class="grok-form-grid">
                            <div class="grok-form-group">
                                <label class="grok-label required">Business Name</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="businessName" 
                                        class="grok-input" 
                                        placeholder="Enter your business name"
                                        value="{{ profile.business_info.business_name if profile else '' }}"
                                        required
                                    >
                                    <span class="input-icon">üè¢</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label">GSTIN</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="gstin" 
                                        class="grok-input" 
                                        placeholder="22AAAAA0000A1Z5"
                                        value="{{ profile.business_info.gstin if profile else '' }}"
                                    >
                                    <span class="input-icon">üßæ</span>
                                </div>
                            </div>

                            <div class="grok-form-group full-width">
                                <label class="grok-label required">Registered Address</label>
                                <div class="grok-input-wrapper">
                                    <textarea 
                                        id="address" 
                                        class="grok-input grok-textarea" 
                                        rows="3"
                                        placeholder="Enter complete business address"
                                        required
                                    >{{ profile.business_info.address if profile else '' }}</textarea>
                                    <span class="input-icon">üìç</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label">State</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="state" 
                                        class="grok-input" 
                                        placeholder="e.g., Maharashtra"
                                        value="{{ profile.business_info.state if profile else '' }}"
                                    >
                                    <span class="input-icon">üó∫Ô∏è</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label">Pincode</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="pincode" 
                                        class="grok-input" 
                                        placeholder="400001"
                                        value="{{ profile.business_info.pincode if profile else '' }}"
                                    >
                                    <span class="input-icon">üìÆ</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label required">Business Email</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="email" 
                                        id="email" 
                                        class="grok-input" 
                                        placeholder="business@example.com"
                                        value="{{ profile.business_info.email if profile else '' }}"
                                        required
                                    >
                                    <span class="input-icon">üìß</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label required">Phone Number</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="tel" 
                                        id="phone" 
                                        class="grok-input" 
                                        placeholder="+91 98765 43210"
                                        value="{{ profile.business_info.phone if profile else '' }}"
                                        required
                                    >
                                    <span class="input-icon">üì±</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label">Website</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="url" 
                                        id="website" 
                                        class="grok-input" 
                                        placeholder="www.yourbusiness.com"
                                        value="{{ profile.business_info.website if profile else '' }}"
                                    >
                                    <span class="input-icon">üåê</span>
                                </div>
                            </div>
                        </div>

                        <div class="grok-form-actions">
                            <button type="submit" class="grok-primary-btn" id="businessSaveBtn">
                                <span class="btn-text">
                                    <span class="btn-icon">üíæ</span>
                                    Save Changes
                                </span>
                                <span class="btn-loader" style="display: none;">
                                    <div class="spinner"></div>
                                    Saving...
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bank Details Tab -->
            <div class="grok-tab-content" id="bankContent">
                <div class="grok-settings-card">
                    <div class="grok-card-header">
                        <h2>Bank Details</h2>
                        <p>Banking information for payment details in documents</p>
                    </div>

                    <form class="grok-form" id="bankForm" onsubmit="updateBankInfo(event)">
                        <div class="grok-form-grid">
                            <div class="grok-form-group">
                                <label class="grok-label required">Account Holder Name</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="accountName" 
                                        class="grok-input" 
                                        placeholder="Account holder name"
                                        value="{{ profile.bank_info.account_name if profile else '' }}"
                                        required
                                    >
                                    <span class="input-icon">üë§</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label required">Account Number</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="accountNumber" 
                                        class="grok-input" 
                                        placeholder="123456789012"
                                        value="{{ profile.bank_info.account_number if profile else '' }}"
                                        required
                                    >
                                    <span class="input-icon">üî¢</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label required">Bank Name</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="bankName" 
                                        class="grok-input" 
                                        placeholder="State Bank of India"
                                        value="{{ profile.bank_info.bank_name if profile else '' }}"
                                        required
                                    >
                                    <span class="input-icon">üè¶</span>
                                </div>
                            </div>

                            <div class="grok-form-group">
                                <label class="grok-label required">IFSC Code</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="ifscCode" 
                                        class="grok-input" 
                                        placeholder="SBIN0001234"
                                        value="{{ profile.bank_info.ifsc_code if profile else '' }}"
                                        required
                                    >
                                    <span class="input-icon">üèõÔ∏è</span>
                                </div>
                            </div>

                            <div class="grok-form-group full-width">
                                <label class="grok-label">Branch Name</label>
                                <div class="grok-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="branch" 
                                        class="grok-input" 
                                        placeholder="Mumbai Main Branch"
                                        value="{{ profile.bank_info.branch if profile else '' }}"
                                    >
                                    <span class="input-icon">üè¢</span>
                                </div>
                            </div>
                        </div>

                        <div class="grok-form-actions">
                            <button type="submit" class="grok-primary-btn" id="bankSaveBtn">
                                <span class="btn-text">
                                    <span class="btn-icon">üíæ</span>
                                    Save Changes
                                </span>
                                <span class="btn-loader" style="display: none;">
                                    <div class="spinner"></div>
                                    Saving...
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Account Settings Tab -->
            <div class="grok-tab-content" id="accountContent">
                <div class="grok-settings-card">
                    <div class="grok-card-header">
                        <h2>Account Settings</h2>
                        <p>Manage your account preferences and security</p>
                    </div>

                    <!-- Usage Statistics -->
                    <div class="grok-stats-section">
                        <h3>üìä Usage Statistics</h3>
                        <div class="grok-stats-grid">
                            <div class="grok-stat-card">
                                <div class="stat-icon">üìÑ</div>
                                <div class="stat-content">
                                    <div class="stat-value">-</div>
                                    <div class="stat-label">PDFs Generated</div>
                                </div>
                            </div>
                            <div class="grok-stat-card">
                                <div class="stat-icon">üìã</div>
                                <div class="stat-content">
                                    <div class="stat-value">-</div>
                                    <div class="stat-label">Documents Created</div>
                                </div>
                            </div>
                            <div class="grok-stat-card">
                                <div class="stat-icon">üìÖ</div>
                                <div class="stat-content">
                                    <div class="stat-value">-</div>
                                    <div class="stat-label">Active Since</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Section -->
                    <div class="grok-security-section">
                        <h3>üîê Security & Privacy</h3>
                        <div class="grok-action-cards">
                            <div class="grok-action-card" onclick="changePassword()">
                                <div class="action-icon">üîë</div>
                                <div class="action-content">
                                    <h4>Change Password</h4>
                                    <p>Update your account password</p>
                                </div>
                                <div class="action-arrow">‚Üí</div>
                            </div>
                            <div class="grok-action-card" onclick="downloadData()">
                                <div class="action-icon">üìÅ</div>
                                <div class="action-content">
                                    <h4>Download Data</h4>
                                    <p>Export your account data</p>
                                </div>
                                <div class="action-arrow">‚Üí</div>
                            </div>
                        </div>
                    </div>

                    <!-- Danger Zone -->
                    <div class="grok-danger-section">
                        <h3>‚ö†Ô∏è Danger Zone</h3>
                        <p class="danger-warning">These actions cannot be undone</p>
                        <div class="grok-danger-actions">
                            <button class="grok-danger-btn" onclick="clearAllData()">
                                <span class="btn-icon">üóëÔ∏è</span>
                                Clear All Data
                            </button>
                            <button class="grok-danger-btn critical" onclick="deleteAccount()">
                                <span class="btn-icon">‚ùå</span>
                                Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success/Error Messages -->
        <div class="grok-message-container" id="messageContainer" style="display: none;">
            <div class="grok-message" id="messageContent"></div>
        </div>
    </div>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('loaded');
            setupInputFocus();
            setupAutoFormat();
        });

        // Tab switching with smooth animations
        function showTab(tab) {
            // Update nav tabs
            document.querySelectorAll('.grok-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');

            // Update content with fade effect
            document.querySelectorAll('.grok-tab-content').forEach(c => {
                c.classList.remove('active');
                c.style.opacity = '0';
            });
            
            setTimeout(() => {
                const activeContent = document.getElementById(tab + 'Content');
                activeContent.classList.add('active');
                activeContent.style.opacity = '1';
            }, 150);
        }

        // Input focus effects
        function setupInputFocus() {
            document.querySelectorAll('.grok-input').forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.classList.remove('focused');
                });
            });
        }

        // Auto-format inputs
        function setupAutoFormat() {
            const gstinInput = document.getElementById('gstin');
            const ifscInput = document.getElementById('ifscCode');
            const pincodeInput = document.getElementById('pincode');

            if (gstinInput) {
                gstinInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.toUpperCase();
                });
            }

            if (ifscInput) {
                ifscInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.toUpperCase();
                });
            }

            if (pincodeInput) {
                pincodeInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/\D/g, '').substring(0, 6);
                });
            }
        }

        // Update business information
        async function updateBusinessInfo(event) {
            event.preventDefault();

            const btn = document.getElementById('businessSaveBtn');
            setLoading(btn, true);

            const businessData = {
                business_info: {
                    business_name: document.getElementById('businessName').value.trim(),
                    gstin: document.getElementById('gstin').value.trim(),
                    address: document.getElementById('address').value.trim(),
                    state: document.getElementById('state').value.trim(),
                    pincode: document.getElementById('pincode').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    website: document.getElementById('website').value.trim(),
                }
            };

            try {
                const response = await fetch('/auth/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(businessData)
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Business information updated successfully! ‚ú®', 'success');
                } else {
                    showMessage(data.message, 'error');
                }

            } catch (error) {
                showMessage('Failed to update business information', 'error');
            } finally {
                setLoading(btn, false);
            }
        }

        // Update bank information
        async function updateBankInfo(event) {
            event.preventDefault();

            const btn = document.getElementById('bankSaveBtn');
            setLoading(btn, true);

            const bankData = {
                bank_info: {
                    account_name: document.getElementById('accountName').value.trim(),
                    account_number: document.getElementById('accountNumber').value.trim(),
                    bank_name: document.getElementById('bankName').value.trim(),
                    ifsc_code: document.getElementById('ifscCode').value.trim().toUpperCase(),
                    branch: document.getElementById('branch').value.trim(),
                }
            };

            try {
                const response = await fetch('/auth/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bankData)
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Bank details updated successfully! üí≥', 'success');
                } else {
                    showMessage(data.message, 'error');
                }

            } catch (error) {
                showMessage('Failed to update bank details', 'error');
            } finally {
                setLoading(btn, false);
            }
        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/auth/logout', { method: 'POST' });
                if (response.ok) {
                    window.location.href = '/auth';
                }
            } catch (error) {
                console.error('Logout failed:', error);
            }
        }

        // Account action functions
        function changePassword() {
            showMessage('Password change functionality coming soon! üîê', 'info');
        }

        function downloadData() {
            showMessage('Data export functionality coming soon! üìÅ', 'info');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                showMessage('Data clearing functionality coming soon! üóëÔ∏è', 'info');
            }
        }

        function deleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                showMessage('Account deletion functionality coming soon! ‚ùå', 'info');
            }
        }

        // Utility functions
        function setLoading(btn, loading) {
            const text = btn.querySelector('.btn-text');
            const loader = btn.querySelector('.btn-loader');

            if (loading) {
                text.style.display = 'none';
                loader.style.display = 'flex';
                btn.disabled = true;
                btn.classList.add('loading');
            } else {
                text.style.display = 'flex';
                loader.style.display = 'none';
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }

        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const content = document.getElementById('messageContent');

            content.textContent = message;
            container.className = `grok-message-container ${type}`;
            container.style.display = 'block';

            // Animate in
            setTimeout(() => container.classList.add('show'), 100);

            // Auto hide after 5 seconds
            setTimeout(() => {
                container.classList.remove('show');
                setTimeout(() => {
                    container.style.display = 'none';
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html> 